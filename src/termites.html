<html>
<header>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

    <script type="text/javascript" src="./expert_system/fact.js"></script>
    <script type="text/javascript" src="./expert_system/rule.js"></script>
    <script type="text/javascript" src="./expert_system/engine.js"></script>
    <script type="text/javascript" src="./expert_system/expert_system.js"></script>

    <script type="text/javascript" src="./vector.js"></script>
	<script type="text/javascript" src="./world.js"></script>
	<script type="text/javascript" src="./agent.js"></script>
    <script type="text/javascript" src="./wall.js"></script>
	<script type="text/javascript" src="./termite_expert_system.js"></script>
	<script type="text/javascript" src="./pheromone.js"></script>
	<script type="text/javascript" src="./wood_heap.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
	<script language="javascript">
	var world = null;
	var canvasElement = null;
	var canvasContext = null;
    var speed = 1;

	var mainLoop = null;
	var lastUpdate = Date.now();
	var dt = 0;

	function updateTime() {
		var now = Date.now();
    	dt = now - lastUpdate;
    	lastUpdate = now;
	}

	function update() {
		updateTime();
		world.update(dt * speed);
		canvasContext.clearRect(0, 0, canvasElement.width, canvasElement.height);
		world.draw(canvasContext);
	}

	function init() {

		canvasElement = document.getElementById("canvas");
		canvasContext = this.canvasElement.getContext("2d");

		world = new World(canvasElement.width, canvasElement.height);

        var woodVolume = 500;

        while (woodVolume > 0) {

            var volumeToTakeAway = Math.ceil(Math.random() * woodVolume / 5) + 50;

            volumeToTakeAway = (volumeToTakeAway > woodVolume) ? woodVolume : volumeToTakeAway;
            woodVolume -= volumeToTakeAway;

            var woodHeap = new WoodHeap();
                world.addAgent(woodHeap);
                woodHeap.setWoodVolume(volumeToTakeAway);
                woodHeap.moveTo(canvasElement.width * Math.random(), canvasElement.height * Math.random());
        }

        for(var i = 0; i < 6; i++) {
            var wall = new Wall();
            world.addAgent(wall);
            wall.moveTo(	canvasElement.width * Math.random(),
                            canvasElement.height * Math.random());
        }

        for(i = 0; i < 50; i ++) {
			var termite = new Termite();
			world.addAgent(termite);
			termite.moveTo(	canvasElement.width * Math.random(),
							canvasElement.height * Math.random());
		}

		var fps = 120;
		mainLoop = setInterval(update, 1000 / fps);
//		update();
	}
	</script>
</header>
<body onload="init()">
    <div id="speedValue">speed = 100%</div>
    <canvas id="canvas" width="600" height="600" style="background-color:#eee; display:inline-block"></canvas>
    <div id="speedSlider" style="width: 500px; margin: 20px;"></div>
    <script>
        $(document).ready(function() {

            $('#speedSlider').slider({
                value: speed,
                step: 0.01,
                min: 0,
                max: 10,
                slide:function() {
                    speed = $('#speedSlider').slider("value");
                    $('#speedValue').html("speed = " + speed * 100 + "%");
                }
            });


        });
    </script>
</body>
</html>